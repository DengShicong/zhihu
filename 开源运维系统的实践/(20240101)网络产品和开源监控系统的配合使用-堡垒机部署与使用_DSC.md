# 网络产品和开源监控系统的配合使用-堡垒机部署与使用

 **Author:** [DSC]

 **Link:** [https://zhuanlan.zhihu.com/p/675548864]

**前** **言**

### 意义  
随着近十年来IT行业的快速变化，企业数字化转型的浪潮席卷而来，传统的安全解决方案在新的环境下面临着各种各样的挑战，为此业界也发展出很多新的安全概念，比如最近几年比较流行的“零信任安全”、“云安全”等。安全问题是企业信息化建设过程中非常重要的一环，随着近年来安全事故的频发，越来越多的企业意识到安全对于企业的重要性。如最近几年比较流行的“零信任安全”、“云安全”等。

当前企业网络运维面临的痛点主要包括网络安全风险、管理复杂性、权限控制困难和审计追踪问题。随着网络环境的日益复杂，这些问题变得越来越突出，尤其是在面对日益增长的网络攻击和内部数据泄露风险时。例如账号管理混乱使得难以定位账号的实际负责人，而缺少统一的运维操作管理授权策略、授权颗粒度粗导致内部操作权限混乱，第三方运维也会带来安全隐患，人员流动性强，缺少行为监控，存在高风险的机密数据失窃可能。企业需要对运维操作的信息安全进行重视。

2019年12月颁布实施的《信息安全技术网络安全等级保护基本要求》中，在身份鉴别、访问控制、安全审计等方面提出了明确的要求。 定位于解决企业IT运维安全审计的堡垒机正是解决此类问题的主要手段。



---

### 文档说明  
此文档是关于开源堡垒机Jumpserver的部署与使用并如何纳管网络产品，以及堡垒机在安全运维审计场景中的一些特色功能。

### 内容描述  
此文档内容如下：

1. 堡垒机的功能简介
2. 堡垒机在《等保2.0》中的应用场景
3. Jumpserver纳管网络设备（ACL及相应安全设置）
4. 堡垒机在运维审计场景的特色功能
5. 延伸

### 系统版本  


| 系统软件 | 版本 | 下载地址 |
| --- | --- | --- |
| Jumpserver | 3.9.3 | [https://community.fit2cloud.com/#/products/jumpserver/downloads](https://community.fit2cloud.com/#/products/jumpserver/downloads) |
| Fedora Linux | 38 | Fedora Server[https://download.fedoraproject.org/pub/fedora/linux/releases/38/Everything/source/tree/Packages](https://download.fedoraproject.org/pub/fedora/linux/releases/38/Everything/source/tree/Packages) |

### 测试环境  
![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-b36a8ed136b07be7eb5b1e6982f8f25b_1440w.jpg)  
## 堡垒机功能简介  
堡垒机的发展起源于网络安全和信息系统运维管理的需求。它是一种专门设计用于控制和监控内部员工或外部人员对关键系统的访问的安全设备。堡垒机的基本原理是在用户和目标系统之间建立一个安全层，实现身份验证和访问授权，同时提供会话监控与记录，确保所有操作的透明性和可追溯性。它还包括命令过滤功能，防止不当操作，以及生成详细的审计日志，支持合规性要求。通过这些功能，堡垒机显著提升了系统安全性，降低了内部威胁，同时提高了网络运维的效率和响应能力。

JumpServer是一个开源的堡垒机，也被称为跳板机，主要用于身份验证、授权、审计和命令执行。它支持多种认证方法，提供会话管理和监控功能，适用于企业进行远程操作和安全管理。JumpServer以其高效和灵活的特点，被广泛应用于各种规模的组织中，特别是在提升网络安全和满足合规要求方面。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-21102e8e3ea1ecf50fe10f0f98b92e3d_1440w.jpg)  


| 序号 | 项目 | 描述 |
| --- | --- | --- |
| 1 | 加强身份验证与访问控制 | 堡垒机在用户和内部网络之间建立了一个身份验证网关。通常要求多因素认证，比如密码结合硬件令牌、短信验证码或生物识别技术。确保只有经过充分验证的用户才能访问敏感资源。 |
| 2 | 会话管理与监控 | 堡垒机对通过它进行的所有会话进行记录和监控。包括用户的登录信息、执行的命令、系统响应以及任何数据交换。监控功能对于检测非授权活动、进行安全审计和事后调查至关重要。 |
| 3 | 命令和权限控制 | 堡垒机能够对用户的活动进行限制，如只允许执行特定的命令或访问特定的数据。可以设定不同的用户权限级别，确保用户只能访问其执行工作所必需的信息。 |
| 4 | 网络隔离与分段 | 堡垒机在网络架构中充当隔离层，帮助将内部网络与外部网络分离。减少网络攻击和数据泄露的风险。 |
| 5 | 合规性与法规遵守 | 对于需要遵守特定数据保护和隐私法规的组织，如GDPR或HIPAA，堡垒机提供了一种有效的遵守手段。日志记录和审计跟踪功能有助于展示组织对于数据访问和处理的控制。 |
| 5 | 安全的远程访问支持 | 在支持远程工作和分布式团队的当今环境，堡垒机提供了一种安全的访问方法。允许远程员工安全地连接到内部网络，同时维持对数据访问的严格控制。 |

备注1：《通用数据保护条例》（General Data Protection Regulation，简称GDPR）为欧洲联盟的条例，前身是欧盟在1995年制定的《计算机数据保护法》。

备注2： HIPAA（Health Insurance Portability and Accountability Act），即《健康保险流通与责任法案》，HIPAA是国际公认的，一套比较完善的针对个人健康信息的隐私安全法律保护体系。



---

**堡垒机《等保》应用场景**  
堡垒机在二级等保合规产品中便有做要求，也被称为“运维审计系统”。  


![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-948697d935f4600a7034ebb53940c4cf_1440w.jpg)  
  
等保整改清单内对于堡垒机之类的安全产品有着更详细的划分。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-bef5f6bc2c954dcaa1539d12157fc982_1440w.jpg)  
  
在等级保护（等保）体系中，堡垒机的用途主要体现在增强网络安全管理、控制和审计方面。等级保护是指根据信息系统的重要程度，对其进行不同等级的安全保护。  
堡垒机在这个框架下的具体用途包括：



| 序号 | 项目 | 描述 |
| --- | --- | --- |
| 1 | 身份验证和访问控制 | 在等级保护体系中，对于访问重要信息系统的身份验证和授权控制至关重要。堡垒机通过实施多因素认证和严格的访问控制策略，确保只有授权人员能够访问特定的系统和数据。 |
| 2 | 操作审计与日志管理 | 等级保护要求对关键系统的操作进行全面的记录和审计。堡垒机能够记录所有通过它进行的活动，包括用户登录详情、执行的命令、系统响应等，为事后审计提供重要依据。 |
| 3 | 网络隔离与安全分区 | 网络隔离是保障关键信息资产安全的重要措施。堡垒机作为隔离层，能有效地隔离内部网络和外部网络，减少潜在的安全威胁。 |
| 4 | 数据泄露防护 | 防止敏感数据泄露是等级保护的核心要求之一。堡垒机通过对数据传输进行监控和控制，帮助防止未授权的数据访问和传输。 |
| 5 | 合规性支持 | 堡垒机的日志记录和监控功能有助于满足等级保护中对操作记录和审计的要求。为遵守相关法规和标准（如ISO 27001、GB/T 22239等）提供了重要支持。 |
| 6 | 应急响应和事故处理 | 在信息安全事故发生时，堡垒机记录的详细日志可以帮助快速定位问题源头，有效支持应急响应和事故处理。 |

### Jumpserver安装部署单机linux安装部署  
  
使用在线安装可实现一键部署：


```
curl -sSL https://resource.fit2cloud.com/jumpserver/jumpserver/releases/latest/download/quick_start.sh | bash
备注：jumpserver同样支持以Linux集群模式部署及kubernetes Helm模式部署。
安装完成后的配置与使用
文件路径为： /opt/jumpserver/config/config.txt
cd /opt/jumpserver-installer-v3.9.3
# 启动
./jmsctl.sh start
# 停止
./jmsctl.sh down
# 卸载
./jmsctl.sh uninstall
# 帮助
./jmsctl.sh -h

```
### 系统登陆安装成功后，通过浏览器访问登录 JumpServer  
![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-bc55805bf0ef25c14310be8c28e88a37_1440w.jpg)  
  
地址: http://<JumpServer服务器IP地址>:<服务运行端口>  
用户名: admin  
密码: admin   


**纳管网络设备**  
使用jumpserver堡垒机对网络设备进行访问管控，并在交换机上设置相应的ACL限制非法设备访问。  
添加网络设备：  


![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-10053593e7737a44ee9e664649bf3fc6_1440w.jpg)  


---

添加SSH连接信息，使得jumpserver可以远程访问网络设备

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-77585731071021cef352d735c9574c43_1440w.jpg)  
测试是否成功连接设备

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-1c70760dfcc7c00f4b456aa1bf04e2cf_1440w.jpg)  
备注：可以看出底层还是通过python的paramiko来进行SSH的安全连接



---

测试堡垒机的web终端远程连接

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-07eb7b2a9e45cca3919001ca7e20f933_1440w.jpg)  
访问控制安全设置：OmniSwitch交换机设置ACL，源地址限制tcp-22的流量，阻止其他来源的远程控制访问，只允许堡垒机进行远程连接。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-693c6856308168fef44cd1e096da021b_1440w.jpg)  
常规安全设置：关闭交换机的telnet连接，只保留安全的SSH连接

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-7516e4812985af1d9a6ddae37b193f16_1440w.jpg)  
IP地址防护设置：对堡垒机做IP地址与MAC地址绑定，防止其他设备修改地址冒充堡垒机。备注：其实堡垒机开启多因子认证后，假冒IP地址也无法登录和管理网络设备。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-062542c9e0d8239b994337531e224893_1440w.jpg)  
  


**堡垒机常用功能实践**  
**用户权限（RBAC）分配**  
创建用户后可以对用户使用的权限进一步细致定义，并设置账号过期时间，对于流动性强的运维工作人员，可以保证权限的及时回收，避免出现信息泄露。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-33484418a88441165d45807a6358af54_1440w.jpg)  
  
同时也可以对登陆的日期做出限制，可以对不同类型人员设置登陆允许时间。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-bc1cb45df823d978b3fa862d88daf9b8_1440w.jpg)  


---

**多因子认证**  
Jumpserver堡垒机可以为不同的人员创建不同的用户账号，将内部员工，巡检人员，管理员等等进行分权分域，明确职责的划分。而通过做IP地址与MAC地址绑定可以确定堡垒机的唯一性后，Jumpserver开源版本也可以通过开启MFA提供给用户进行多因子认证及修改密码，以多方位保护用户与设备的安全。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-ba131b69a64175baa95ae8a4514a0eeb_1440w.jpg)  
![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-b86a31494454021922ed3bf99955bf05_1440w.jpg)  
![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-4f76a02ffa413d9630877704eec80695_1440w.jpg)  
在开启MFA进行多因子验证后，重新登陆会提示使用手机验证器进行扫码绑定账号，并且每次登陆都需要输入六位验证数字进行验证。



---

**高危命令过滤**  
可以对用户进行命令的过滤，设置高危命令过滤，防止出现误操作、恶意破坏。进一步保护设备安全。首先创建目录组，可以创建多个高危命令组，

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-37b714ca4f455cbbcb71f862364436f8_1440w.jpg)  
再创建命令过滤规则，设置针对的用户、资产与优先级，并调用需要过滤的命令的命令组，如创建一个命令过滤规则去调用reboot规则组，并设置规则行动，允许还是拒绝执行。。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-97bc6d01596d7a6a7e6e397a7d9b23b1_1440w.jpg)  
再次进入web终端对OS2260-10进行命令过滤测试，可以看出高危命令已被禁止执行。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-5c01e4a5807d23a2e93bca66b02ffe54_1440w.jpg)  
**会话录像与回放**  
在审计台内可以对每一次远程访问控制进行监控，从具体用户的登陆记录、操作记录，会话操作的命令都有具体的实际信息。而每一次的远程会话都会保存有录像回放，可供在线回看及下载

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-51ddac7a46a890eab11f829f6cc75a3b_1440w.jpg)  
可支持调整倍数，切换回放，在出现事故或其他情况时，不仅可以明确定义操作责任人，还有具体的命令记录及操作回放作为证据。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-8cc73eebc2dbcc5168fc7dbdcd0fd757_1440w.jpg)  


---

**技术拓展**

### Jumpserver开源和商业功能区别  
目前为止Jumpserver堡垒机项目已发展九年，按月更新，在堡垒机市场较为成熟，GitHub上有22.8K star 较为火热。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-e602dac83387fd7068bc3557295bc02c_1440w.jpg)  
![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-dafadd59b5a36d8da6a7af403e8f260c_1440w.jpg)  
Jumpserver除了提供开源版本也有商业版本。

开源版主要提供核心的访问控制和审计功能，适用于需要基本安全管理的环境，也有对账号分权分域的详细管理，足以满足基本使用。而企业版在认证、自定义及服务的方面有着更多的功能。



| 特性/服务 | 开源版 3.0 | 企业版 3.0 |
| --- | --- | --- |
| 基础访问控制 | 是 | 是 |
| 命令审计 | 是 | 是 |
| 文件传输审计 | 是 | 是 |
| 多因素认证 | 是 | 是 |
| 会话录像与回放 | 是 | 是 |
| 系统健康监控 | 否 | 是 |
| RADIUS二次认证和短信认证 | 否 | 是 |
| 子账户管理 | 否 | 是 |
| 资产同步 | 否 | 是 |
| 工单管理 | 否 | 是 |
| 账户备份 | 否 | 是 |
| 基于角色的访问控制（RBAC） | 是 | 是 |
| 密码变更计划 | 否 | 是 |
| 可自定义的LOGO和主题 | 否 | 是 |
| 单点登录系统 | 否 | 是 |
| 资产登录和命令复审 | 否 | 是 |
| 账户收集 | 否 | 是 |
| 客户支持 | 社区支持 | 7x24小时支持 |
| 安装和培训 | 否 | 是 |
| 紧急响应 | 否 | 是 |
| 专家咨询 | 否 | 是 |
| 软件升级 | 否 | 是 |
| 在线自助服务 | 否 | 是 |

### Jumpserver堡垒机的高阶功能  
* 支持定制化大屏展示监控  
Jumpserver堡垒机有较好的可扩展性与兼容性用以与外部组件对接，如对接外部数据库Mysql。在完成设备纳管，用户分权分域后，可以通过对接监控大屏来展示Jumpserver堡垒机的监控信息，包含资产的数量或类型，用户数量、访问设备次数等等。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-209475f60e59d3f65b601d359ae85586_1440w.jpg)  
大屏展示效果如下：

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-c93e4a90f4acf81128a456f364c84a10_1440w.jpg)  
* 集群可靠部署  
Jumpserver同样支持以Linux集群模式部署及kubernetes Helm模式部署。采用容器化的部署方式和微服务架构，每一层的服务都是独立的容器服务，可单独启停。同时各个组件可按需部 署在一套或者多套环境中，以保证高可靠性。  
案例1：以下是其官网介绍的X丰快递

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-9ef438c8a9b313508e38f6fc33000c34_1440w.jpg)  
  
案例2：以下是其官网介绍的X讯海外游戏安全运维  


![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-75a2dcedf431ad3a3b2073ed2b378a7d_1440w.jpg)  
* 支持元原生运维场景

JumpServer可以实现基于公有云API的云资产自动纳管。用户只需在 JumpServer中设置云账号的 API访问凭证，即可自动同步云上所有的主机资源信息。这对于拥有大量云资产的用户来说，省去了初次资产导入的繁重工作。在后期的运维工作中，当云资产发生变化时，JumpServer亦可自动同步最新的资源信息，无需人工进行频繁维护。与此同时，在云资产同步的过程中，JumpServer还支持基于云资产属性的自动分组策略。此外，对于最新的以 Kubernetes为代表的云原生基础设施资产，JumpServer也率先完成了对其进行运维操作审计的支持。

![]((20240101)网络产品和开源监控系统的配合使用-堡垒机部署与使用_DSC/v2-d1ae5848d5c31801ce5af9a5f0ad2803_1440w.jpg)  
### 其他开源的堡垒机产品  
备注：排名不分先后先后

1. Teleport  
Teleport是一款简单易用的开源堡垒机系统，内建了所需的脚本引擎、WEB服务等模块，因此不需要额外安装其他的库或者模块，具有小巧、易用的特点，支持 RDP/SSH/SFTP/Telnet 协议的远程连接和审计管理。
2. Rundeck   
开源的自动化工具，支持命令执行和任务调度等功能，也可以作为堡垒机进行访问控制。
3. HashiCorp Vault  
开源的机密管理系统，其中包括支持SSH访问的堡垒机功能。
4. NetBox:  
开源的IP地址管理和设备管理系统，包括一些堡垒机功能。
5. PAM:  
Linux上的Pluggable Authentication Modules，可以进行认证方式的扩展，也可以作为堡垒机进行访问控制。
6. Webmin  
Web化的Linux系统管理工具，可以进行堡垒机管理和访问控制。
7. Lynis: 开源的系统审计和安全扫描工具，可以用作堡垒机进行访问控制。

  


**本人涉及资料来源于日常工作及互联网搜索，已做脱敏处理，如果仍存有涉及侵权内容，请告知。将做删除修改。如有错误，欢迎大家指正。**

